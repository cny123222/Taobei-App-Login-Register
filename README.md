# æ·˜è´åº”ç”¨ - æµ‹è¯•é©±åŠ¨å¼€å‘é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäºæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)åŸåˆ™æ„å»ºçš„æ‰‹æœºéªŒè¯ç ç™»å½•/æ³¨å†Œç³»ç»Ÿã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React + TypeScript + Vite
- **åç«¯**: Node.js + Express + SQLite
- **æµ‹è¯•æ¡†æ¶**: 
  - å‰ç«¯: Vitest + React Testing Library
  - åç«¯: Jest + Supertest

### é¡¹ç›®ç»“æ„
```
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/                # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ app.js         # Expressåº”ç”¨ä¸»æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js    # æ•°æ®åº“æ“ä½œç±»
â”‚   â”‚   â””â”€â”€ routes/        # APIè·¯ç”±
â”‚   â”‚       â””â”€â”€ auth.js    # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â”œâ”€â”€ test/              # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.test.js           # æ•°æ®åº“æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ routes/auth.test.js        # è·¯ç”±æµ‹è¯•
â”‚   â”‚   â””â”€â”€ integration/api.integration.test.js  # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ package.json       # åç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ jest.config.js     # Jestæµ‹è¯•é…ç½®
â”œâ”€â”€ frontend/               # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”‚   â””â”€â”€ components/    # Reactç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚       â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚       â””â”€â”€ CountryCodeSelector.tsx
â”‚   â”œâ”€â”€ test/              # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # ç»„ä»¶æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ e2e/          # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â””â”€â”€ setup.ts      # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ package.json       # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ vite.config.ts     # Viteé…ç½®
â”‚   â””â”€â”€ tsconfig.json      # TypeScripté…ç½®
â”œâ”€â”€ verify-system.js        # ç³»ç»ŸéªŒè¯è„šæœ¬
â”œâ”€â”€ integration-test.js     # é›†æˆæµ‹è¯•è„šæœ¬
â””â”€â”€ .artifacts/            # æ¥å£å®šä¹‰æ–‡ä»¶
    â”œâ”€â”€ ui_interface.yml
    â”œâ”€â”€ api_interface.yml
    â””â”€â”€ data_interface.yml
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åç«¯ä¾èµ–
cd backend
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd ../frontend
npm install
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡ (ç«¯å£ 3000)
cd backend
npm run dev

# æ–°å¼€ç»ˆç«¯ï¼Œå¯åŠ¨å‰ç«¯æœåŠ¡ (ç«¯å£ 5173)
cd frontend
npm run dev
```

### 3. éªŒè¯ç³»ç»Ÿ

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œç³»ç»ŸéªŒè¯
./verify-system.js

# æˆ–è€…ä½¿ç”¨ node è¿è¡Œ
node verify-system.js
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯•ç±»å‹

1. **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªç»„ä»¶æˆ–å‡½æ•°
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
3. **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹
4. **ç³»ç»ŸéªŒè¯**: éªŒè¯æœåŠ¡å¯åŠ¨å’Œè¿é€šæ€§

### è¿è¡Œæµ‹è¯•

```bash
# åç«¯æµ‹è¯•
cd backend
npm test                                    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test -- --verbose --bail --forceExit   # è¯¦ç»†è¾“å‡ºï¼Œé‡é”™åœæ­¢

# å‰ç«¯æµ‹è¯•
cd frontend
npm test                                    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test -- --run --reporter=verbose --bail=1  # è¯¦ç»†è¾“å‡ºï¼Œé‡é”™åœæ­¢

# ç³»ç»ŸéªŒè¯
./verify-system.js                         # éªŒè¯ç³»ç»ŸçŠ¶æ€

# é›†æˆæµ‹è¯•
./integration-test.js                      # æµ‹è¯•å®Œæ•´æµç¨‹
```

### æµ‹è¯•è¦†ç›–ç‡

é¡¹ç›®è¦æ±‚è¾¾åˆ°ä»¥ä¸‹æµ‹è¯•è¦†ç›–ç‡ï¼š
- æ¯ä¸ªAPIæ¥å£å¿…é¡»æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
- æ¯ä¸ªReactç»„ä»¶å¿…é¡»æœ‰å¯¹åº”çš„ç»„ä»¶æµ‹è¯•
- æ¯ä¸ªç”¨æˆ·æµç¨‹å¿…é¡»æœ‰å¯¹åº”çš„ç«¯åˆ°ç«¯æµ‹è¯•
- æ‰€æœ‰é”™è¯¯å¤„ç†åœºæ™¯å¿…é¡»æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… æ‰‹æœºå·éªŒè¯ç ç™»å½•
- âœ… æ‰‹æœºå·éªŒè¯ç æ³¨å†Œ
- âœ… å›½å®¶/åœ°åŒºä»£ç é€‰æ‹©
- âœ… éªŒè¯ç å‘é€é¢‘ç‡é™åˆ¶
- âœ… ç”¨æˆ·åè®®ç¡®è®¤

### APIæ¥å£
- `GET /health` - å¥åº·æ£€æŸ¥
- `POST /api/auth/send-verification-code` - å‘é€éªŒè¯ç 
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ

### å®‰å…¨ç‰¹æ€§
- âœ… CORSè·¨åŸŸé…ç½®
- âœ… è¯·æ±‚é¢‘ç‡é™åˆ¶
- âœ… è¾“å…¥éªŒè¯å’Œæ¸…ç†
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ”§ å¼€å‘å·¥å…·

### æµ‹è¯•é…ç½®

**åç«¯æµ‹è¯•é…ç½® (jest.config.js)**:
```javascript
module.exports = {
  testTimeout: 10000,
  bail: 1,
  verbose: true,
  forceExit: true,
  detectOpenHandles: true
}
```

**å‰ç«¯æµ‹è¯•é…ç½® (vite.config.ts)**:
```typescript
export default defineConfig({
  test: {
    testTimeout: 10000,
    hookTimeout: 10000,
    teardownTimeout: 10000,
    bail: 1,
    reporter: ['verbose'],
    environment: 'jsdom'
  }
})
```

### ä»£ç†é…ç½®

å‰ç«¯å¼€å‘æœåŠ¡å™¨é…ç½®äº†APIä»£ç†ï¼Œå°† `/api/*` è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨:
```typescript
server: {
  port: 5173,
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true
    }
  }
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3000  # åç«¯ç«¯å£
   lsof -i :5173  # å‰ç«¯ç«¯å£
   
   # æ€æ­»å ç”¨è¿›ç¨‹
   kill -9 <PID>
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - ç¡®ä¿SQLiteæ•°æ®åº“æ–‡ä»¶æƒé™æ­£ç¡®
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨

3. **æµ‹è¯•å¤±è´¥**
   - ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
   - æ£€æŸ¥æµ‹è¯•ç¯å¢ƒé…ç½®
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

4. **CORSé”™è¯¯**
   - ç¡®è®¤åç«¯CORSé…ç½®æ­£ç¡®
   - æ£€æŸ¥å‰ç«¯ä»£ç†é…ç½®

### æ—¥å¿—å’Œè°ƒè¯•

- åç«¯æ—¥å¿—: æ§åˆ¶å°è¾“å‡º
- å‰ç«¯æ—¥å¿—: æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æµ‹è¯•æŠ¥å‘Š: `system-verification-report.json` å’Œ `integration-test-report.json`

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

è¿è¡Œç³»ç»ŸéªŒè¯å’Œé›†æˆæµ‹è¯•åï¼Œä¼šç”Ÿæˆè¯¦ç»†çš„JSONæŠ¥å‘Šï¼š

- `system-verification-report.json` - ç³»ç»ŸéªŒè¯æŠ¥å‘Š
- `integration-test-report.json` - é›†æˆæµ‹è¯•æŠ¥å‘Š

è¿™äº›æŠ¥å‘ŠåŒ…å«ï¼š
- æµ‹è¯•æ‰§è¡Œæ—¶é—´æˆ³
- æµ‹è¯•é€šè¿‡/å¤±è´¥ç»Ÿè®¡
- è¯¦ç»†çš„æµ‹è¯•ç»“æœ
- é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘åŸåˆ™
2. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. ä¿æŒä»£ç è¦†ç›–ç‡
4. éµå¾ªä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæ•™è‚²ç›®çš„ã€‚