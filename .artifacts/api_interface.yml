- type: Backend
  id: API-POST-SendVerificationCode
  route: POST /api/auth/send-verification-code
  description: 发送验证码到指定手机号，用于登录或注册验证。
  input:
    type: JSON
    body:
      phoneNumber: string
      countryCode: string (optional, default: "+86")
  output:
    success:
      statusCode: 200
      body: { message: "验证码已发送", expiresIn: 60 }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 429
        body: { error: "请求过于频繁，请稍后再试" }
  dependencies:
    - DB-SaveVerificationCode
  acceptanceCriteria:
    - 验证手机号格式的有效性。
    - 生成6位随机数字验证码。
    - 验证码在控制台打印（开发环境）。
    - 验证码有效期为60秒。
    - 同一手机号60秒内只能发送一次验证码。
  changeLog:
    - date: "2025-01-27"
      description: "初始创建。"

- type: Backend
  id: API-POST-Login
  route: POST /api/auth/login
  description: 处理用户登录请求，验证手机号和验证码。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
      countryCode: string (optional, default: "+86")
  output:
    success:
      statusCode: 200
      body: { message: "登录成功", userId: "uuid", token: "jwt" }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 401
        body: { error: "验证码错误" }
      - statusCode: 404
        body: { error: "该手机号未注册，请先完成注册" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
  acceptanceCriteria:
    - 验证手机号格式。
    - 检查手机号是否已注册。
    - 验证验证码的正确性和有效性。
    - 登录成功后生成JWT token。
    - 返回用户基本信息。
  changeLog:
    - date: "2025-01-27"
      description: "初始创建。"

- type: Backend
  id: API-POST-Register
  route: POST /api/auth/register
  description: 处理用户注册请求，包含验证码校验和用户创建。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
      countryCode: string (optional, default: "+86")
      agreeToTerms: boolean
  output:
    success:
      statusCode: 201
      body: { message: "注册成功", userId: "uuid", token: "jwt" }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 401
        body: { error: "验证码错误" }
      - statusCode: 409
        body: { error: "该手机号已注册，将直接为您登录", userId: "uuid", token: "jwt" }
      - statusCode: 422
        body: { error: "请同意用户协议" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
    - DB-CreateUser
  acceptanceCriteria:
    - 验证手机号格式。
    - 验证用户是否同意协议。
    - 验证验证码的正确性和有效性。
    - 如果手机号已注册，直接登录并返回token。
    - 如果手机号未注册，创建新用户并返回token。
  changeLog:
    - date: "2025-01-27"
      description: "初始创建。"

- type: Backend
  id: API-GET-UserProfile
  route: GET /api/user/profile
  description: 获取当前登录用户的基本信息。
  input:
    type: Headers
    headers:
      Authorization: "Bearer {jwt_token}"
  output:
    success:
      statusCode: 200
      body: { userId: "uuid", phoneNumber: "string", createdAt: "datetime" }
    error:
      - statusCode: 401
        body: { error: "未授权访问" }
      - statusCode: 404
        body: { error: "用户不存在" }
  dependencies:
    - DB-FindUserByPhone
  acceptanceCriteria:
    - 验证JWT token的有效性。
    - 返回用户的基本信息（不包含敏感数据）。
    - 处理token过期和无效的情况。
  changeLog:
    - date: "2025-01-27"
      description: "初始创建。"