- type: Backend
  id: API-POST-SendVerificationCode
  route: POST /api/auth/send-verification-code
  description: 为指定手机号发送验证码，支持登录和注册场景。
  input:
    type: JSON
    body:
      phoneNumber: string
  output:
    success:
      statusCode: 200
      body: { message: "验证码已发送", expiresIn: 60 }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 429
        body: { error: "请求过于频繁，请稍后再试" }
  dependencies:
    - DB-GenerateVerificationCode
  acceptanceCriteria:
    - 当接收到格式正确的手机号时，应返回200状态码。
    - 验证码应在控制台打印输出。
    - 当手机号格式无效时，应返回400错误。
    - 应实现60秒的请求频率限制。
  changeLog:
    - date: "2025-01-20"
      description: "初始创建。"

- type: Backend
  id: API-POST-Login
  route: POST /api/auth/login
  description: 处理用户登录请求，验证手机号和验证码。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
  output:
    success:
      statusCode: 200
      body: { userId: "uuid", token: "jwt", message: "登录成功" }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 401
        body: { error: "验证码错误" }
      - statusCode: 404
        body: { error: "该手机号未注册，请先完成注册" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
  acceptanceCriteria:
    - 当手机号已注册且验证码正确时，应返回200状态码和用户信息。
    - 当手机号未注册时，应返回404错误。
    - 当验证码错误时，应返回401错误。
    - 成功登录后应生成JWT token。
  changeLog:
    - date: "2025-01-20"
      description: "初始创建。"

- type: Backend
  id: API-POST-Register
  route: POST /api/auth/register
  description: 处理用户注册请求，包含验证码校验和用户创建。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
      agreeToTerms: boolean
  output:
    success:
      statusCode: 201
      body: { userId: "uuid", token: "jwt", message: "注册成功" }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
      - statusCode: 401
        body: { error: "验证码错误" }
      - statusCode: 409
        body: { error: "该手机号已注册，将直接为您登录" }
      - statusCode: 422
        body: { error: "请同意用户协议" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
    - DB-CreateUser
  acceptanceCriteria:
    - 当手机号未注册、验证码正确且同意协议时，应返回201状态码。
    - 当手机号已注册时，应返回409状态码并自动登录。
    - 当未同意协议时，应返回422错误。
    - 当验证码错误时，应返回401错误。
    - 成功注册后应自动登录并生成JWT token。
  changeLog:
    - date: "2025-01-20"
      description: "初始创建。"